{
    "name": "indexing-querying",
    "description": "Indexes part of the data for HTTP logs, then concurrently queries OpenSearch while indexing the remainder. Includes optional 'preference' parameter for search queries.",
    "default": false,
    "schedule": [
      {
        "operation": "delete-index"
      },
      {
        "operation": {
          "operation-type": "create-index",
          "settings": {{index_settings | default({}) | tojson}}
        }
      },
      {
        "name": "check-cluster-health",
        "operation": {
          "operation-type": "cluster-health",
          "index": "logs-*",
          "request-params": {
            "wait_for_status": "{{cluster_health | default('green')}}",
            "wait_for_no_relocating_shards": "true"
          },
          "retry-until-success": true
        }
      },
      {
        "name": "initial-index-append",
        "operation": {
          "operation-type": "bulk",
          "bulk-size": {{bulk_size | default(5000)}},
          "ingest-percentage": {{initial_ingest_percentage | default(50)}}
        },
        "warmup-time-period": 120,
        "clients": {{bulk_indexing_clients | default(8)}},
        "ignore-response-error-level": "{{error_level | default('non-fatal')}}"
      },
      {
        "name": "refresh-after-index",
        "operation": "refresh"
      },
      {
        "parallel": {
          "tasks": [
            {
              "name": "concurrent-index-append",
              "operation": {
                "operation-type": "bulk",
                "bulk-size": {{bulk_size | default(5000)}},
                "ingest-percentage": {{100 - (initial_ingest_percentage | default(50))}}
              },
              "clients": {{bulk_indexing_clients | default(8)}},
              "ignore-response-error-level": "{{error_level | default('non-fatal')}}"
            },
            {
              "operation": "default",
              "warmup-iterations": 500,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 8
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "name": "term",
              "operation": "term",
              "warmup-iterations": 500,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 50
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "range",
              "warmup-iterations": 100,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 1
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "200s-in-range",
              "warmup-iterations": 500,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 33
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "400s-in-range",
              "warmup-iterations": 500,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 50
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "hourly_agg",
              "warmup-iterations": 50,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.2
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "multi_term_agg",
              "warmup-iterations": 50,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.2
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "scroll",
              "warmup-iterations": 100,
              "iterations": 200,
              "#COMMENT": "Throughput is considered per request. So we issue one scroll request per second which will retrieve 25 pages",
              "target-throughput": 1
            },
            {
              "operation": "desc_sort_size",
              "warmup-iterations": 200,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "asc_sort_size",
              "warmup-iterations": 200,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "desc_sort_timestamp",
              "warmup-iterations": 200,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "asc_sort_timestamp",
              "warmup-iterations": 200,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "desc_sort_with_after_timestamp",
              "warmup-iterations": 10,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "operation": "asc_sort_with_after_timestamp",
              "warmup-iterations": 10,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "name": "desc-sort-timestamp-after-force-merge-1-seg",
              "operation": "desc_sort_timestamp",
              "warmup-iterations": 200,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 2
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "name": "asc-sort-timestamp-after-force-merge-1-seg",
              "operation": "asc_sort_timestamp",
              "warmup-iterations": 200,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 2
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "name": "desc-sort-with-after-timestamp-after-force-merge-1-seg",
              "operation": "desc_sort_with_after_timestamp",
              "warmup-iterations": 10,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            },
            {
              "name": "asc-sort-with-after-timestamp-after-force-merge-1-seg",
              "operation": "asc_sort_with_after_timestamp",
              "warmup-iterations": 10,
              "iterations": 100
              {%- if not target_throughput %}
              ,"target-throughput": 0.5
              {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
              {%- else %}
              ,"target-throughput": {{ target_throughput | tojson }}
              {%- endif %}
              {%-if search_clients is defined and search_clients %}
              ,"clients": {{ search_clients | tojson}}
              {%- endif %}
            }
    ]
        }
      }
    ]
  }